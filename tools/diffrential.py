import hash_framework.algorithms._md4 as m

import cmsh
from cmsh.array import l_xor

datas = [(([2787629912, 166624029, 2173013050, 3228120650], [3832065070, 893546744, 1503935559, 3886004964, 376807297, 3095397902, 2796181248, 3999295543, 323295553, 1610735870, 2587804664, 4228497797, 178758430, 2483281279, 2820549323, 3686939348]), ([2787629912, 166624029, 2173013050, 3228120650], [3832065070, 3041030392, 3382983751, 3886004964, 376807297, 3095397902, 2796181248, 3999295543, 323295553, 1610735870, 2587804664, 4228497797, 178692894, 2483281279, 2820549323, 3686939348])), (([653455935, 1565260673, 3137556433, 4202621184], [2038427517, 1123791086, 215937401, 2386431847, 3318571745, 831650557, 2161014768, 147835980, 3578493883, 2041825069, 2090718892, 2302132736, 3631922409, 138719306, 2977038875, 2257501855]), ([653455935, 1565260673, 3137556433, 4202621184], [2038427517, 3271274734, 2631856505, 2386431847, 3318571745, 831650557, 2161014768, 147835980, 3578493883, 2041825069, 2090718892, 2302132736, 3631987945, 138719306, 2977038875, 2257501855]))]

model = cmsh.Model()

for data in datas:
    left, right = data
    l_iv, l_ba = left
    r_iv, r_ba = right

    l_b = model.join_vec(map(lambda x: model.to_vec(x, width=32), l_ba))
    r_b = model.join_vec(map(lambda x: model.to_vec(x, width=32), r_ba))
    db = l_b ^ r_b
    print(bin(int(db)))

    l_r, l_rsa = m.md4(model, l_ba, iv=l_iv)
    r_r, r_rsa = m.md4(model, r_ba, iv=r_iv)

    l_rs = model.join_vec(l_rsa)
    r_rs = model.join_vec(r_rsa)
    dp = l_rs ^ r_rs

    print(bin(int(dp)))
